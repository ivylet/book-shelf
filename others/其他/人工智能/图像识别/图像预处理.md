# 图像数据预处理（2）
### 1.1 实验简介
图像预处理的主要目的是消除图像中无关的信息，恢复有用的真实信息，增强有关信息的可检测性、最大限度地简化数据，从而改进特征提取、图像分割、匹配和识别的可靠性。
本实验使用OpenCV图像处理库实现基本的图像预处理操作。包括图像的颜色空间转换、坐标变化、灰度变化、直方图变化和图像滤波。
### 1.2 实验步骤
#### 1.2.1 基本操作
注意：所有实验中代码所读取的图片，选用自己电脑本地图片读取；图片路径为自己本地的实际路径。
- 步骤 1	定义matshow函数，使图片更方便的显示（与上次实验一样，先定义函数）


```python
import matplotlib.pyplot as plt
import numpy as np
import cv2
%matplotlib inline
# import matplotlib as mpl

    
# 使用matplotlib显示opencv图片，用于显示
def matshow(title='image',image=None,gray=False):

    if isinstance(image,np.ndarray):
        if len(image.shape) ==2:
            pass
        elif gray == True:
            # 转化opencv的颜色空间为gray
            image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
        else:
            # 转化opencv的颜色空间为RGB
            image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
    plt.figure()
    # 使用plt载入opencv图片
    plt.imshow(image,cmap='gray')
    
    plt.axis('off') # 不显示坐标轴
    plt.title(title) # 图像标题
    # 如果第一遍运行不显示图像，运行第二次就会正常了
    plt.show()
```

- 步骤 2	图像的读取和显示


```python
import cv2
# 读取一副图像 第一个参数是图像路径
# 第二个参数代表读取方式，1表示3通道彩色，0表示单通道灰度
im = cv2.imread(r"picture.jpg",0)
# 在"test"窗口中显示图像im
matshow("test",im)
```


![png](Untitled_files/Untitled_3_0.png)


- 步骤 3	图像的保存


```python
# 将图像保存到指定路径
cv2.imwrite('picture1.jpg',im)
```




    True



#### 1.2.2 灰度变化
- 步骤 1	灰度变化。反转，灰度拉伸，灰度压缩


```python
import numpy as np
import cv2
from matplotlib import pyplot as plt

# 定义线性灰度变化函数
# k>1时 实现灰度数值的拉伸
# 0<k<1时 实现灰度数值的压缩
# k=-1 b=255 实现灰度反转
def linear_trans(img, k, b=0):
    # 计算灰度线性变化的映射表
    trans_list = [(np.float32(x)*k+b) for x in range(256)]
    # 将列表转换为np.array
    trans_table =np.array(trans_list)
    # 将超过[0,255]灰度范围的数值进行调整,并指定数据类型为uint8
    trans_table[trans_table>255] = 255
    trans_table[trans_table<0] = 0
    trans_table = np.round(trans_table).astype(np.uint8)
    # 使用OpenCV的look up table函数修改图像的灰度值
    return cv2.LUT(img, trans_table)

im = cv2.imread('picture1.jpg',0)
matshow('org', im)

# 反转
im_inversion = linear_trans(im, -1, 255)
matshow('inversion', im_inversion)
# 灰度拉伸
im_stretch = linear_trans(im, 2)#要求：自己填入一个参数，实现灰度拉伸，具体提示可参看此段代码前面标红注释
matshow('graystretch', im_stretch)
# 灰度压缩
im_compress = linear_trans(im, 0.5 ) #要求：自己填入一个参数，实现灰度压缩，具体提示可参看此段代码前面标红注释
matshow('graycompress', im_compress)
```


![png](Untitled_files/Untitled_7_0.png)



![png](Untitled_files/Untitled_7_1.png)



![png](Untitled_files/Untitled_7_2.png)



![png](Untitled_files/Untitled_7_3.png)


- 步骤 2	伽马变化


```python
import numpy as np
import cv2
from matplotlib import pyplot as plt

# 定义伽马变化函数
def gamma_trans(img, gamma):
    # 先归一化到1，做伽马计算，再还原到[0,255]
    gamma_list = [np.power(x / 255.0, gamma) * 255.0 for x in range(256)]
    # 将列表转换为np.array，并指定数据类型为uint8
    gamma_table = np.round(np.array(gamma_list)).astype(np.uint8)
    # 使用OpenCV的look up table函数修改图像的灰度值
    return cv2.LUT(img, gamma_table)

im = cv2.imread('picture1.jpg',0)
matshow('org', im)

# 使用伽马值为0.5的变化，实现对暗部的拉升，亮部的压缩
im_gama05 = gamma_trans(im, 0.5) #要求：按上面注释提示填入一个参数伽马值
matshow('gama0.5', im_gama05)
# 使用伽马值为2的变化，实现对亮部的拉升，暗部的压缩
im_gama2 = gamma_trans(im,2) #要求：按上面注释提示填入一个参数伽马值
matshow('gama2', im_gama2)
```


![png](Untitled_files/Untitled_9_0.png)



![png](Untitled_files/Untitled_9_1.png)



![png](Untitled_files/Untitled_9_2.png)


#### 1.2.3 直方图
- 步骤 1	直方图的显示


```python
import cv2
from matplotlib import pyplot as plt
# 读取并显示图像
im = cv2.imread("picture1.jpg",0)
matshow('org', im)

# 绘制灰度图像的直方图
plt.hist(im.ravel(), 256, [0,256])
plt.show()
```


![png](Untitled_files/Untitled_11_0.png)



![png](Untitled_files/Untitled_11_1.png)


- 步骤 2	直方图均衡化


```python
import cv2
from matplotlib import pyplot as plt

im = cv2.imread("picture1.jpg ",0)
matshow('org', im)

# 调用OpenCV的直方图均衡化API
im_equ1 = cv2.equalizeHist(im)
matshow('equal', im_equ1)

# 显示原始图像的直方图
plt.subplot(2,1,1)
plt.hist(im.ravel(), 256, [0,256],label='org')
plt.legend()

# 显示均衡化图像的直方图
plt.subplot(2,1,2)
plt.hist(im_equ1.ravel(), 256, [0,256],label='equalize')
plt.legend()
plt.show()
```


![png](Untitled_files/Untitled_13_0.png)



![png](Untitled_files/Untitled_13_1.png)



![png](Untitled_files/Untitled_13_2.png)


#### 1.2.4 滤波
- 步骤 1	中值滤波


```python
import cv2
import numpy as np

im = cv2.imread('picture1.jpg')
matshow('org',im)

# 调用OpenCV的中值模糊API
im_medianblur = cv2.medianBlur(im, 5) 
  
matshow('median_blur',im_medianblur)
```


![png](Untitled_files/Untitled_15_0.png)



![png](Untitled_files/Untitled_15_1.png)


- 步骤 2	均值滤波


```python
# 方法一：直接调用OpenCV的API
import cv2
import numpy as np

im = cv2.imread('picture1.jpg')
matshow('org',im)

# 调用OpenCV的均值模糊API
im_meanblur1 = cv2.blur(im, (3, 3)) 

matshow('mean_blur_1',im_meanblur1)



# 方法二：使用均值算子和filter2D 自定义滤波操作
import cv2
import numpy as np

im = cv2.imread('picture1.jpg')
matshow('org',im)
# 均值算子
mean_blur = np.ones([3, 3], np.float32)/9

# 使用filter2D进行滤波操作
im_meanblur2 = cv2.filter2D(im,-1,mean_blur)
matshow('mean_blur_2',im_meanblur2)

```


![png](Untitled_files/Untitled_17_0.png)



![png](Untitled_files/Untitled_17_1.png)



![png](Untitled_files/Untitled_17_2.png)



![png](Untitled_files/Untitled_17_3.png)


- 步骤 3 高斯滤波


```python
# 方法一：直接调用OpenCV的API
import cv2
import numpy as np

im = cv2.imread('picture1.jpg')
matshow('org',im)

# 调用OpenCV的高斯模糊API
im_gaussianblur1 = cv2.GaussianBlur(im, (5, 5), 0) 

matshow('gaussian_blur_1',im_gaussianblur1)


# 方法二：使用高斯算子和filter2D 自定义滤波操作
import cv2
import numpy as np

im = cv2.imread('picture1.jpg')
matshow('org',im)
# 高斯算子
gaussian_blur = np.array([
    [1,4,7,4,1],
    [4,16,26,16,4],
    [7,26,41,26,7],
    [4,16,26,16,4],
    [1,4,7,4,1]], np.float32)/273

# 使用filter2D进行滤波操作
im_gaussianblur2 = cv2.filter2D(im,-1,gaussian_blur)
matshow('gaussian_blur_2',im_gaussianblur2)
```


![png](Untitled_files/Untitled_19_0.png)



![png](Untitled_files/Untitled_19_1.png)



![png](Untitled_files/Untitled_19_2.png)



![png](Untitled_files/Untitled_19_3.png)


- 步骤4 锐化


```python
import cv2
import numpy as np

im = cv2.imread('picture1.jpg')
matshow('org',im)
# 锐化算子
sharpen_1 = np.array([
        [-1,-1,-1],
        [-1,9,-1],
        [-1,-1,-1]])
# 使用filter2D进行滤波操作
im_sharpen1 = cv2.filter2D(im,-1,sharpen_1)
matshow('sharpen_1',im_sharpen1)

# 锐化算子2
sharpen_2 = np.array([
        [0,-1,0],
        [-1,8,-1],
        [0,1,0]])/4.0

# 使用filter2D进行滤波操作
im_sharpen2 = cv2.filter2D(im,-1,sharpen_2)
matshow('sharpen_2',im_sharpen2)
```


![png](Untitled_files/Untitled_21_0.png)



![png](Untitled_files/Untitled_21_1.png)



![png](Untitled_files/Untitled_21_2.png)


### 1.3 实验小结
本章主要介绍了应用基于Python语言的OpenCV图像处理库进行图像预处理实验的具体操作。使用OpenCV图像处理库实现了图像的颜色空间转换、坐标变化、灰度变化、直方图变化和图像滤波。加深对图像预处理技术的感知，为使用图像预处理技术提供了实际的操作指导。

